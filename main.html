<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>

<head>
	<title>TODO supply a title</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">



	<script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
	<link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css" />
	<script src="index.js"></script>
	<link rel="stylesheet" href="css/main.css" />
</head>

<body>

	<script>
		function getCurrentUserInfo(){
	   var user = firebase.auth().currentUser;
   firebase.auth().onAuthStateChanged(function(user) {
	 if (user) {
	   var currentUserRef = db.collection("users").doc(user.uid);

	   currentUserRef.get().then(function(doc) {
		   if (doc.exists) {
			   var photoUrl=doc.data().profileImageUrl;
			   document.getElementById("userDescription").innerHTML=doc.data().description;				
			   document.getElementById("userName").innerHTML=doc.data().name;				
			   document.getElementById("userGender").innerHTML=doc.data().gender;				
			   document.getElementById("userWantedGender").innerHTML=doc.data().lookingFor;				
			   document.getElementById("currentUserCardID").style.backgroundImage="url("+photoUrl+")";				
			   
		   } else {
			   // doc.data() will be undefined in this case
			   console.log("No such document!");
		   }
	   }).catch(function(error) {
		   console.log("Error getting document:", error);
	   });

	 }});
		}
	</script>

	<div class="navbar">
		<!-- Usuniete id="mySidenav"-->

		<!--
		<a href="#">Dodaj zdjecie</a>
		<input type="file" id="photo" />
		<button onclick="uploadImage(db)">Upload Image</button>
		-->
		<a href="#">Strona główna</a>

		
  <!--
				  TUTAJ ZACZYNA SIE ZMIENIANIE TEGO GORNEGO NAVBARA!!!!!!
			  -->
		<div class="dropdown">
			<span>Ustawienia</span>
			<div class="dropdown-content">
				<button id="profileBtn">Profile</button></br>
				<button id="genderBtn">Gender</button>

				<input type="file" id="photo" />
				<button onclick="uploadImage(db)">Upload Image</button>
			</div>
		  </div>

		  <div id="myModal" class="modal">

			<!-- Modal content -->
			<div class="modal-content">
			  <span class="close">&times;</span>
			  <!-- <label class="switch">

				  <!-- <label id="chooseDIstance">Choose Distance</label>
				<input type="checkbox" id="switchValue" value="false" onchange="updateSwitchInput(this.checked)">
				<span class="slider round"></span>
				<label id="chooseUnlimited">Unlimited</label> 

				
			  </label>
			  <input type="text" id="switchText" value=""> -->

			</div>
		  
		  </div>

		  <div id="profileModal" class="modal">
			<span class="closeProfile">&times;</span>

			<div class="modal-content">
					 <div id="currentUserCardID" class="currentUserCard">
						 Name:<div id="userName"></div></br>
						 Description:<div id="userDescription"></div></br>
						 Gender:<div id="userGender"></div></br>
						Szukam:<div id="userWantedGender""></div></br>
					<script>getCurrentUserInfo();</script>
					 </div>
			 
			  </div>
			
		  </div>

		  <div id="genderModal" class="modal">
			<span class="closeGender">&times;</span>


			<div class="modal-content">
				
			<div id="scrollDistance">
				Podaj
				<input type="range" id="volume" name="volume"
					   min="0" max="250" onchange="updateTextInput(this.value)">
				<input type="text" id="textInput" value="">
			  </div>

				<h4>Szukam:</h4></br>
				<div class="container">
				  <input type="radio" id="lookForMale" name="wantedGender" value="male" onchange="updateGenderInput(this.value)">
				  <label class="male" for="lookForMale">Mężczyzna</label>
		  
				  <input type="radio" id="lookForBisexual" name="wantedGender" value="male Female" onchange="updateGenderInput(this.value)" >
				  <label class="bisexual" for="lookForBisexual">Obie płcie</label>
		  
				  <input type="radio" id="lookForFemale" name="wantedGender" value="female" onchange="updateGenderInput(this.value)" >
				  <label class="female" for="lookForFemale">Kobieta</label>
				</div>
			 
			  </div>
			
		  </div>

		  
		  <script>



		function updateGenderInput(value)
		{
			var user = firebase.auth().currentUser;
		   firebase.auth().onAuthStateChanged(function(user) {
			 if (user) {
								// To update age and favorite color:
					db.collection("users").doc(user.uid).update({
						lookingFor:value
					})
					
									}
		  

		});	
		}

				function updateTextInput(val) {
		  document.getElementById('textInput').value=val;
		  
		  var user = firebase.auth().currentUser;
		   firebase.auth().onAuthStateChanged(function(user) {
			 if (user) {
								// To update age and favorite color:
					db.collection("users").doc(user.uid).update({
						searchingRange:val
					})
					
									}
		  

		});
	}
		
			function updateSwitchInput(val) {
			  document.getElementById("switchText").value=val; 
			
			}
		  </script>

				<script>
					// Get the modal
					var modalProfile = document.getElementById("profileModal");
					// Get the button that opens the modal
					var btnProfile = document.getElementById("profileBtn");
					
					// Get the <span> element that closes the modal
					var spanProfile = document.getElementsByClassName("closeProfile")[0];

					// When the user clicks the button, open the modal 
					btnProfile.onclick = function() {
					modalProfile.style.display = "block";
					}


					
					
					// When the user clicks on <span> (x), close the modal
					spanProfile.onclick = function() {
					modalProfile.style.display = "none";
					}
					
					// When the user clicks anywhere outside of the modal, close it
					window.onclick = function(event) {
					if (event.target == modalProfile) {
						modalProfile.style.display = "none";
					}
					
					}

					</script>

					<script>
						// Get the modal
						var modalGender = document.getElementById("genderModal");
						// Get the button that opens the modal
						var btnGender = document.getElementById("genderBtn");
						
						// Get the <span> element that closes the modal
						var spanGender = document.getElementsByClassName("closeGender")[0];
	
						// When the user clicks the button, open the modal 
						btnGender.onclick = function() {
						modalGender.style.display = "block";
						}
	
	
						
						
						// When the user clicks on <span> (x), close the modal
						spanGender.onclick = function() {
						modalGender.style.display = "none";
						}
						
						// When the user clicks anywhere outside of the modal, close it
						window.onclick = function(event) {
						if (event.target == modalGender) {
							modalGender.style.display = "none";
						}
						
						}
	
						</script>


		  <!-- <script>
			// Get the modal
			var modal = document.getElementById("myModal");
			// Get the button that opens the modal
			var btn = document.getElementById("myBtn");
			
			// Get the <span> element that closes the modal
			var span = document.getElementsByClassName("close")[0];

			// When the user clicks the button, open the modal 
			btn.onclick = function() {
			  modal.style.display = "block";
			}

		
			
			
			// When the user clicks on <span> (x), close the modal
			span.onclick = function() {
			  modal.style.display = "none";
			}
			
			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function(event) {
			  if (event.target == modal) {
				modal.style.display = "none";
			  }
			  
			}

			</script> -->
		  <!--
				  TUTAJ KONCZY SIE  SIE ZMIENIANIE TEGO GORNEGO NAVBARA!!!!!!
			  -->
		
					<!--<a href="#">Usun konto</a>-->
		<a href="#" onclick="logout()">Wyloguj</a>

	</div>


	<div id="mySidenav" class="mySidenav">

		<div class="mySidecloseopenbutton">
			<span class="mySlideOpenButton"style="font-size:30px;cursor:pointer;position:absolute" onclick="openNav()">&#9776; </span>
	
			<a href="javascript:void(0)" class="mySlideCloseButton" onclick="closeNav()">&times;</a>
			</div>

		<div id="matchesDiv">
		
		</div class="mySidenavProfiles">
		<script>
			chatFunction();

			function openNav() {
				document.getElementById("mySidenav").style.width = "300px";
				
			}

			function closeNav() {
				document.getElementById("mySidenav").style.width = "100px";
			}
		</script>
		</div>
	</div></div>

	
	<div class="middlesite">
		<div id="dataCard">
			Name:<div id="userNameData"></div></br>
			Description:<div id="userDescriptionData"></div></br>
			Gender:<div id="userGenderData"></div></br>
		   Szukam:<div id="userWantedGenderData"></div></br>
			
	
	</div>
		<div id="card">
		
		<script>
			if (sessionStorage.getItem('AuthenticationState') === null) {
   window.open("AccessDenied.html", "_self");
}
//Is their authentication token still valid?
else if (Date.now > new Date(sessionStorage.getItem('AuthenticationExpires'))) {
      window.open("AccessDenied.html", "_self");
}
else {
	mainFunction();

}
		</script>
		</div>
	</div>

	<div class="rightSite">
		<div id="usersCard">

			<h1>Chat</h1>

		</div>
	</div>
</body>

</html>